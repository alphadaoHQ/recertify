"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[173],{8173:(e,t,n)=>{n.d(t,{U:()=>A});var r=n(206),i=n(9767);let s=[{name:"state",methodId:77589,arguments:[],returnType:{kind:"simple",type:"State",optional:!1}},{name:"isAdmin",methodId:122448,arguments:[{name:"addr",type:{kind:"simple",type:"address",optional:!1}}],returnType:{kind:"simple",type:"bool",optional:!1}},{name:"token",methodId:68497,arguments:[{name:"id",type:{kind:"simple",type:"int",optional:!1,format:257}}],returnType:{kind:"simple",type:"Token",optional:!0}},{name:"token_uri",methodId:86159,arguments:[{name:"id",type:{kind:"simple",type:"int",optional:!1,format:257}}],returnType:{kind:"simple",type:"string",optional:!1}}],a=[{receiver:"internal",message:{kind:"typed",type:"AddAdmin"}},{receiver:"internal",message:{kind:"typed",type:"Mint"}}];class o{static async init(e,t){return await CertificationNFT_init(e,t)}static async fromInit(e,t){let n=await CertificationNFT_init(e,t);return new o((0,r.contractAddress)(0,n),n)}static fromAddress(e){return new o(e)}async send(e,t,n,i){let s=null;if(!i||"object"!=typeof i||i instanceof r.Slice||"AddAdmin"!==i.$$type||(s=(0,r.beginCell)().store(storeAddAdmin(i)).endCell()),!i||"object"!=typeof i||i instanceof r.Slice||"Mint"!==i.$$type||(s=(0,r.beginCell)().store(storeMint(i)).endCell()),null===s)throw Error("Invalid message type");await e.internal(t,{...n,body:s})}async getState(e){let t=new r.TupleBuilder;return loadGetterTupleState((await e.get("state",t.build())).stack)}async getIsAdmin(e,t){let n=new r.TupleBuilder;return n.writeAddress(t),(await e.get("isAdmin",n.build())).stack.readBoolean()}async getToken(e,t){let n=new r.TupleBuilder;n.writeNumber(t);let i=(await e.get("token",n.build())).stack.readTupleOpt();return i?loadTupleToken(i):null}async getTokenUri(e,t){let n=new r.TupleBuilder;return n.writeNumber(t),(await e.get("token_uri",n.build())).stack.readString()}constructor(e,t){this.abi={types:CertificationNFT_types,getters:s,receivers:a,errors:CertificationNFT_errors},this.address=e,this.init=t}}o.MAX_SUPPLY=10000n,o.storageReserve=0n,o.errors=CertificationNFT_errors_backward,o.opcodes={AddAdmin:0xd68b1eb7,Mint:0xb295e54a,Deploy:0x1f067c44};var d=n(5704);let l=d.env.NEXT_PUBLIC_CONTRACT_ADDRESS||"",c=d.env.NEXT_PUBLIC_TESTNET_ENDPOINT||"https://testnet.toncenter.com/api/v2/jsonRPC",u={validUntil:600,mintValue:d.env.NEXT_PUBLIC_MINT_VALUE||"0.05",addAdminValue:d.env.NEXT_PUBLIC_ADD_ADMIN_VALUE||"0.05"},m={MINT:Number(d.env.NEXT_PUBLIC_OPCODE_MINT)||0x8ffada24,ADD_ADMIN:Number(d.env.NEXT_PUBLIC_OPCODE_ADD_ADMIN)||0xd68b1eb7};class p{buildMintTransactionForCollection(e,t){let n=(0,r.beginCell)().storeUint(m.MINT,32).storeAddress(r.Address.parse(t)).storeRef((0,r.beginCell)().endCell()).endCell();return{validUntil:Math.floor(Date.now()/1e3)+u.validUntil,messages:[{address:e,amount:(0,r.toNano)(u.mintValue).toString(),payload:n.toBoc().toString("base64")}]}}buildDeployTransaction(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"0.05";return{validUntil:Math.floor(Date.now()/1e3)+u.validUntil,messages:[{address:"",amount:(0,r.toNano)(n).toString(),init:{code:e,data:t}}]}}async retryWithBackoff(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:3e4;for(let i=0;i<t;i++)try{return await e()}catch(e){if(i===t-1)throw e;if(e instanceof Error&&(e.message.includes("429")||e.message.includes("rate limit")||e.message.includes("too many requests"))){let e=Math.min(n*2**i,r);console.log("RATE LIMIT: Retrying in ".concat(e,"ms (attempt ").concat(i+1,"/").concat(t,")")),await new Promise(t=>setTimeout(t,e))}else throw e}throw Error("Max retries exceeded")}getContractAddress(){var e;return(null==(e=this.contractAddress)?void 0:e.toString())||null}async getState(){if(!this.contractAddress)throw Error("CONTRACT_ADDRESS not set");return this.retryWithBackoff(async()=>{let e=this.client.open(o.fromAddress(this.contractAddress)),t=await e.getState();return{owner:t.owner.toString(),total:t.total,nextId:t.nextId,base_uri:t.base_uri}})}async isAdmin(e){if(!this.contractAddress)throw Error("CONTRACT_ADDRESS not set");return this.retryWithBackoff(async()=>this.client.open(o.fromAddress(this.contractAddress)).getIsAdmin(r.Address.parse(e)))}async getToken(e){if(!this.contractAddress)throw Error("CONTRACT_ADDRESS not set");try{let t=this.client.open(o.fromAddress(this.contractAddress)),n=await t.getToken(e);if(!n)return null;return{id:e,student:n.student.toString(),metadata:n.metadata.toString()}}catch(e){return console.error("getToken error",e),null}}async getTokenUri(e){if(!this.contractAddress)throw Error("CONTRACT_ADDRESS not set");return this.client.open(o.fromAddress(this.contractAddress)).getTokenUri(e)}async getAllTokens(){let e=await this.getState(),t=[];for(let n=1n;n<e.nextId;n++){let e=await this.getToken(n);e&&t.push(e)}return t}buildMintTransaction(e){let t=(0,r.beginCell)().storeUint(m.MINT,32).storeAddress(r.Address.parse(e)).storeRef((0,r.beginCell)().endCell()).endCell();return{validUntil:Math.floor(Date.now()/1e3)+u.validUntil,messages:[{address:l,amount:(0,r.toNano)(u.mintValue).toString(),payload:t.toBoc().toString("base64")}]}}buildAddAdminTransaction(e){let t=(0,r.beginCell)().storeUint(m.ADD_ADMIN,32).storeAddress(r.Address.parse(e)).endCell();return{validUntil:Math.floor(Date.now()/1e3)+u.validUntil,messages:[{address:l,amount:(0,r.toNano)(u.addAdminValue).toString(),payload:t.toBoc().toString("base64")}]}}constructor(){this.client=new i.TonClient({endpoint:c}),this.contractAddress=l?r.Address.parse(l):null}}let A=new p}}]);